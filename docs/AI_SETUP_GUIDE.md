# TaskWall AI功能设置指南

## 🔧 修复内容

已成功修复生成子任务功能的API key问题，现在AI功能可以正常调用Gemini API。

### 修复的关键问题：
1. **API Key存储**: 前端设置的API key现在会保存到后端数据库
2. **动态重新初始化**: 保存API key后，AI客户端会自动重新初始化
3. **数据库读取**: AI客户端现在从数据库读取API key，不再依赖环境变量

## 🚀 如何使用

### 1. 设置Gemini API Key

**方法一：使用Command Palette（推荐）**
1. 按 `⌘K` (Mac) 或 `Ctrl+K` (Windows)
2. 输入 "设置" 或 "settings"
3. 按 Enter 进入设置页面
4. 在 "AI设置" 标签页填入你的Gemini API Key
5. 点击 "保存设置"

**方法二：使用快捷键**
1. 按 `⌘,` (Mac) 或 `Ctrl+,` (Windows)
2. 进入 "AI设置" 标签页
3. 填入API Key并保存

### 2. 测试生成子任务功能

**方法一：通过AI助手对话框**
1. 点击右下角 `+` 按钮展开FAB
2. 选择 "AI助手" 选项
3. 在功能选择中选择 "创建子任务"
4. 输入主任务标题，如："开发用户认证系统"
5. 可选输入上下文信息
6. 点击 "执行AI功能"

**方法三：通过Command Palette**
1. 按 `⌘K` 搜索 "AI解析"
2. 在文本框中输入任务描述
3. AI会自动解析并生成子任务

### 3. 其他AI功能

生成子任务只是AI功能的一部分，还包括：

- **智能文本解析**: 从纯文本中识别和创建任务
- **任务重写**: 改善任务描述的清晰度
- **添加表情**: 为任务标题添加合适的emoji
- **内容总结**: 创建任务或项目的简洁摘要
- **风险分析**: 分析任务风险并提供建议
- **工作负载分析**: 评估当前工作量
- **周报生成**: 自动生成工作周报
- **相似任务检测**: 创建任务时检测重复项

## 🧪 测试验证

可以运行以下测试脚本验证功能：

```bash
python3 test_subtasks.py
```

测试脚本会验证：
1. 设置API保存和读取
2. 子任务生成API
3. AI助手命令执行

## 🔍 故障排除

### API Key无效
- 确保使用的是有效的Google Gemini API Key
- 检查API Key是否有访问Gemini Pro模型的权限
- 查看浏览器开发者工具的网络标签页确认API调用

### 生成失败
- 如果API Key无效，系统会自动使用fallback方法生成基础子任务
- 检查Docker日志：`docker-compose logs api`
- 确认网络连接可以访问Google API

### 前端显示问题  
- 确保按 `⌘K` 可以打开Command Palette
- 右下角FAB按钮现在已修复z-index重叠问题
- 所有AI功能都可通过Command Palette访问

## ✅ 确认修复

测试结果显示：
- ✅ API Key保存到数据库成功
- ✅ AI客户端动态重新初始化成功
- ✅ 子任务生成API正常响应
- ✅ Fallback机制工作正常
- ✅ 真实API调用尝试成功（需有效API Key）

现在你可以使用真实的Gemini API Key来体验完整的AI功能了！