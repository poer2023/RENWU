<!DOCTYPE html>
<html>
<head>
    <title>ç›´æ¥åˆ é™¤åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 5px;
        }
        button {
            margin: 5px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-primary { background: #2196f3; color: white; }
        .btn-success { background: #4caf50; color: white; }
        .btn-danger { background: #f44336; color: white; }
        .btn-info { background: #00bcd4; color: white; }
        #taskframe {
            width: 100%;
            height: 600px;
            border: 2px solid #ddd;
            border-radius: 5px;
        }
        .log {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry {
            margin: 2px 0;
            padding: 2px 5px;
        }
        .log-success { background: #d4edda; color: #155724; }
        .log-error { background: #f8d7da; color: #721c24; }
        .log-info { background: #d1ecf1; color: #0c5460; }
        .log-warning { background: #fff3cd; color: #856404; }
        .instructions {
            margin: 20px 0;
            padding: 15px;
            background: #fff8e1;
            border-left: 4px solid #ffc107;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª TaskWall åˆ é™¤åŠŸèƒ½ç›´æ¥æµ‹è¯•</h1>
        
        <div class="instructions">
            <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
            <p>è¿™ä¸ªé¡µé¢åµŒå…¥äº†TaskWallåº”ç”¨ï¼Œè®©ä½ å¯ä»¥ç›´æ¥æµ‹è¯•åˆ é™¤åŠŸèƒ½ï¼š</p>
            <ol>
                <li>ç­‰å¾…ä¸‹æ–¹çš„TaskWallåº”ç”¨å®Œå…¨åŠ è½½</li>
                <li>ä½¿ç”¨å°åœ°å›¾ï¼ˆå³ä¸‹è§’ï¼‰æ‰¾åˆ°å¹¶å®šä½ä»»åŠ¡</li>
                <li>ç‚¹å‡»ä»»åŠ¡é€‰æ‹©å®ƒ</li>
                <li>æµ‹è¯•ä¸åŒçš„åˆ é™¤æ–¹å¼</li>
                <li>è§‚å¯Ÿä¸‹æ–¹çš„æ—¥å¿—è¾“å‡º</li>
            </ol>
        </div>
        
        <div class="test-controls">
            <h3>ğŸ® æµ‹è¯•æ§åˆ¶</h3>
            <button class="btn-info" onclick="focusFrame()">èšç„¦åˆ°åº”ç”¨</button>
            <button class="btn-primary" onclick="testDeleteKey()">æ¨¡æ‹ŸDeleteé”®</button>
            <button class="btn-primary" onclick="testCtrlD()">æ¨¡æ‹ŸCtrl+D</button>
            <button class="btn-success" onclick="checkTasks()">æ£€æŸ¥ä»»åŠ¡æ•°é‡</button>
            <button class="btn-danger" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
            <button class="btn-info" onclick="openDevTools()">æ‰“å¼€å¼€å‘è€…å·¥å…·</button>
        </div>
        
        <iframe 
            id="taskframe" 
            src="http://localhost:3000" 
            onload="onFrameLoad()"
        ></iframe>
        
        <div class="log" id="logContainer">
            <div class="log-entry log-info">ç­‰å¾…TaskWallåº”ç”¨åŠ è½½...</div>
        </div>
    </div>

    <script>
        let frame = null;
        let logContainer = null;
        
        function log(message, type = 'info') {
            if (!logContainer) logContainer = document.getElementById('logContainer');
            
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function onFrameLoad() {
            frame = document.getElementById('taskframe');
            log('TaskWallåº”ç”¨æ¡†æ¶å·²åŠ è½½', 'success');
            
            // ç›‘å¬iframeä¸­çš„äº‹ä»¶
            try {
                const iframeWindow = frame.contentWindow;
                
                // ç›‘å¬é”®ç›˜äº‹ä»¶
                iframeWindow.addEventListener('keydown', (e) => {
                    if (e.key === 'Delete') {
                        log('æ£€æµ‹åˆ°Deleteé”®æŒ‰ä¸‹', 'info');
                    } else if (e.ctrlKey && e.key === 'd') {
                        log('æ£€æµ‹åˆ°Ctrl+DæŒ‰ä¸‹', 'info');
                    }
                });
                
                // ç›‘å¬ç‚¹å‡»äº‹ä»¶
                iframeWindow.addEventListener('click', (e) => {
                    if (e.target.closest('.task-node')) {
                        log('ä»»åŠ¡è¢«ç‚¹å‡»é€‰æ‹©', 'success');
                    } else if (e.target.closest('button') && e.target.textContent.includes('ğŸ—‘')) {
                        log('åˆ é™¤æŒ‰é’®è¢«ç‚¹å‡»', 'warning');
                    }
                });
                
                log('äº‹ä»¶ç›‘å¬å™¨å·²è®¾ç½®', 'success');
            } catch (error) {
                log(`è®¾ç½®äº‹ä»¶ç›‘å¬å™¨å¤±è´¥: ${error.message}`, 'error');
            }
            
            // å®šæœŸæ£€æŸ¥ä»»åŠ¡æ•°é‡
            setInterval(checkTasksInFrame, 5000);
        }
        
        function focusFrame() {
            if (frame) {
                frame.contentWindow.focus();
                log('å·²èšç„¦åˆ°TaskWallåº”ç”¨', 'info');
            }
        }
        
        function testDeleteKey() {
            if (frame) {
                try {
                    const event = new KeyboardEvent('keydown', {
                        key: 'Delete',
                        code: 'Delete',
                        keyCode: 46,
                        which: 46,
                        bubbles: true
                    });
                    
                    frame.contentWindow.document.dispatchEvent(event);
                    log('å‘é€Deleteé”®äº‹ä»¶', 'info');
                } catch (error) {
                    log(`å‘é€Deleteé”®å¤±è´¥: ${error.message}`, 'error');
                }
            }
        }
        
        function testCtrlD() {
            if (frame) {
                try {
                    const event = new KeyboardEvent('keydown', {
                        key: 'd',
                        code: 'KeyD',
                        ctrlKey: true,
                        keyCode: 68,
                        which: 68,
                        bubbles: true
                    });
                    
                    frame.contentWindow.document.dispatchEvent(event);
                    log('å‘é€Ctrl+Däº‹ä»¶', 'info');
                } catch (error) {
                    log(`å‘é€Ctrl+Då¤±è´¥: ${error.message}`, 'error');
                }
            }
        }
        
        function checkTasks() {
            checkTasksInFrame();
        }
        
        function checkTasksInFrame() {
            if (frame) {
                try {
                    const taskElements = frame.contentWindow.document.querySelectorAll('.task-wrapper, .task-node');
                    log(`å½“å‰ä»»åŠ¡æ•°é‡: ${taskElements.length}`, 'success');
                    
                    const selectedTasks = frame.contentWindow.document.querySelectorAll('.task-wrapper.selected, .task-node.selected');
                    if (selectedTasks.length > 0) {
                        log(`é€‰ä¸­çš„ä»»åŠ¡æ•°é‡: ${selectedTasks.length}`, 'info');
                    }
                } catch (error) {
                    log(`æ£€æŸ¥ä»»åŠ¡å¤±è´¥: ${error.message}`, 'error');
                }
            }
        }
        
        function clearLogs() {
            if (logContainer) {
                logContainer.innerHTML = '<div class="log-entry log-info">æ—¥å¿—å·²æ¸…ç©º</div>';
            }
        }
        
        function openDevTools() {
            log('è¯·æŒ‰F12æˆ–å³é”®â†’æ£€æŸ¥å…ƒç´ æ‰“å¼€å¼€å‘è€…å·¥å…·', 'info');
            log('åˆ‡æ¢åˆ°Networkæ ‡ç­¾ç›‘æ§DELETEè¯·æ±‚', 'info');
            log('åˆ‡æ¢åˆ°Consoleæ ‡ç­¾æŸ¥çœ‹JavaScriptæ—¥å¿—', 'info');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            logContainer = document.getElementById('logContainer');
            log('æµ‹è¯•é¡µé¢å·²å°±ç»ª', 'success');
            
            // æ·»åŠ é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'l') {
                    e.preventDefault();
                    clearLogs();
                } else if (e.key === 'F5') {
                    log('åˆ·æ–°é¡µé¢...', 'info');
                }
            });
            
            log('å¿«æ·é”®: Ctrl+Læ¸…ç©ºæ—¥å¿—', 'info');
        });
        
        // ç›‘å¬iframeä¸­çš„ç½‘ç»œè¯·æ±‚ï¼ˆå¦‚æœå¯èƒ½ï¼‰
        function monitorNetworkRequests() {
            if (frame && frame.contentWindow) {
                try {
                    // é‡å†™fetchå‡½æ•°æ¥ç›‘æ§è¯·æ±‚
                    const originalFetch = frame.contentWindow.fetch;
                    frame.contentWindow.fetch = function(...args) {
                        const url = args[0];
                        const options = args[1] || {};
                        
                        if (options.method === 'DELETE' || (typeof url === 'string' && url.includes('tasks'))) {
                            log(`ç½‘ç»œè¯·æ±‚: ${options.method || 'GET'} ${url}`, 'warning');
                        }
                        
                        return originalFetch.apply(this, args).then(response => {
                            if (options.method === 'DELETE') {
                                log(`DELETEå“åº”: ${response.status}`, response.ok ? 'success' : 'error');
                            }
                            return response;
                        });
                    };
                    
                    log('ç½‘ç»œè¯·æ±‚ç›‘æ§å·²å¯ç”¨', 'success');
                } catch (error) {
                    log(`ç½‘ç»œç›‘æ§è®¾ç½®å¤±è´¥: ${error.message}`, 'error');
                }
            }
        }
        
        // å»¶è¿Ÿå¯ç”¨ç½‘ç»œç›‘æ§
        setTimeout(monitorNetworkRequests, 3000);
    </script>
</body>
</html>