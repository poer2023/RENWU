<!DOCTYPE html>
<html>
<head>
    <title>TaskWall Component Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
    </style>
</head>
<body>
    <h1>TaskWall 组件测试</h1>
    
    <div class="test-section">
        <h2>主应用测试</h2>
        <iframe src="http://localhost:3000" width="100%" height="600" id="main-app"></iframe>
    </div>
    
    <div class="test-section">
        <h2>测试结果</h2>
        <div id="test-results">
            <p>正在运行测试...</p>
        </div>
    </div>
    
    <script>
        const results = document.getElementById('test-results');
        
        function addResult(message, type = 'info') {
            const p = document.createElement('p');
            p.textContent = message;
            p.className = type;
            results.appendChild(p);
        }
        
        function runTests() {
            addResult('开始测试...', 'info');
            
            // 测试 API 连接
            fetch('http://localhost:3000/api/tasks/')
                .then(response => {
                    if (response.ok) {
                        addResult('✅ API 连接正常', 'success');
                        return response.json();
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                })
                .then(data => {
                    addResult(`✅ 获取到 ${data.length} 个任务`, 'success');
                })
                .catch(error => {
                    addResult(`❌ API 连接失败: ${error.message}`, 'error');
                });
            
            // 测试组件文件存在性
            const componentTests = [
                'http://localhost:3000/src/components/task/TaskCardLOD.vue',
                'http://localhost:3000/src/components/task/TaskConnectionsLazy.vue',
                'http://localhost:3000/src/composables/useVirtualizedTasks.ts'
            ];
            
            componentTests.forEach(url => {
                fetch(url)
                    .then(response => {
                        if (response.ok) {
                            addResult(`✅ ${url.split('/').pop()} 文件可访问`, 'success');
                        } else {
                            addResult(`⚠️ ${url.split('/').pop()} 文件访问异常`, 'warning');
                        }
                    })
                    .catch(error => {
                        addResult(`❌ ${url.split('/').pop()} 文件访问失败`, 'error');
                    });
            });
        }
        
        // iframe 加载完成后运行测试
        document.getElementById('main-app').onload = function() {
            addResult('主应用已加载', 'success');
            setTimeout(runTests, 2000);
        };
        
        document.getElementById('main-app').onerror = function() {
            addResult('主应用加载失败', 'error');
        };
    </script>
</body>
</html>