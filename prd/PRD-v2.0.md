# Task Wall – PRD v2.0 (Advanced‑AI Edition)

**Owner:** 大哥  **Last Update:** 2025‑06‑19

> v2.0 在 v1.0 MVP 的基础上，引入 6 大「惊艳型」AI 功能，以"让 AI 真正代班"的理念彻底升级体验。

---

## 1 · Background Recap

MVP 已解决"快速捕获 + 便利贴画布"核心痛点，但依赖人工拆分、排期、周报输出，认知负担仍高。目标让 AI 主动承担规划、提醒、总结等脑力工作，为单人 PM 带来"会思考的任务墙"。

---

## 2 · Goals & Key Metrics (新增)

| 目标             | 指标                | 基线→目标      |
| -------------- | ----------------- | ---------- |
| **G‑1 AI 参与度** | 用户日均 AI 调用次数      | 0 → ≥ 10 次 |
| **G‑2 减负效果**   | 每周手动创建/编辑操作数      | ↓ 30%      |
| **G‑3 效率感知**   | Beta 问卷："明显轻松" 评分 | ≥ 80% "同意" |

---

## 3 · Personas Update

新增 **P3: 忙碌主管** —— 每天 100+ 消息，需要一句话看懂团队进展；期望 1 分钟生成周报。

---

## 4 · Epic & User Stories (新增 EP‑A)

### **EP‑A 惊艳 AI 助手**

| US #      | User Story                                       | Priority |
| --------- | ------------------------------------------------ | -------- |
| **US‑A1** | 作为 PM，当我在卡片上键入 `/` 时，希望 AI 根据上下文生成/补全标题或描述并可直接替换 | P0       |
| **US‑A2** | 作为 PM，我想按 `⇧⌘K` 全局搜索卡片内容并高亮跳转                    | P0       |
| **US‑A3** | 作为 PM，我创建新任务时，系统应自动拆分子任务并画出推荐依赖                  | P0       |
| **US‑A4** | 当存在相似任务时，系统应提示"合并/关联"并可一键连线                      | P1       |
| **US‑A5** | 我在拖动卡片时，侧栏实时显示当天工时负载并用红/黄/绿提示冲突                  | P1       |
| **US‑A6** | 我想切换到"主题岛"视图，系统自动聚类任务并着色分区                       | P2       |
| **US‑A7** | 我想一键生成上周回顾 & 下周计划 (Markdown)                     | P0       |
| **US‑A8** | 系统应扫描文字情绪/风险并在右上角列出⚠️列表                          | P1       |

---

## 5 · Functional Requirements (增补)

### 5.1 AI 助手笔 & 全局搜索

| ID       | 需求         | 说明                                                                                  |
| -------- | ---------- | ----------------------------------------------------------------------------------- |
| **F‑A1** | `/ai` 命令模式 | 光标聚焦卡片后输入 `/` 弹出 Mini‑Prompt；支持指令：`rewrite`、`add‑emoji`、`summarize`、`make‑subtasks` |
| **F‑A2** | 全局模糊搜索     | 顶栏输入框或 `⇧⌘K`；实时高亮匹配标题 & 描述；回车跳转并闪烁卡片                                                |

### 5.2 自动子任务 & 关联

| ID       | 需求     | 说明                                           |
| -------- | ------ | -------------------------------------------- |
| **F‑A3** | 子任务生成  | LLM Prompt：为父任务输出 ≤5 子任务 JSON；前端创建子卡片并自动连线   |
| **F‑A4** | 相似任务检测 | 新任务 embedding 与现有任务 cosine>0.85 时弹窗建议"合并/关联" |

### 5.3 工时预测 & 冲突

| ID       | 需求   | 说明                                                        |
| -------- | ---- | --------------------------------------------------------- |
| **F‑A5** | 工时估算 | P0=8h, P1=6h, P2=4h, P3=2h, P4=1h（首版固定）；用户可在侧栏微调 ± 小时并持久化 |
| **F‑A6** | 冲突提示 | 当日总工时 > Daily Cap (默认 6h) 时，卡片底部出现红条；侧栏统计红/黄/绿            |

### 5.4 主题岛聚类视图

| ID       | 需求   | 说明                                                         |
| -------- | ---- | ---------------------------------------------------------- |
| **F‑A7** | 聚类算法 | 每晚 1 AM 后台运行 HDBSCAN on OpenAI embeddings；生成 island id     |
| **F‑A8** | 视觉呈现 | Toggle 「Island Mode」后，画布对同 island 卡片自动成簇并着背景色渐变；点击岛名可折叠/展开 |

### 5.5 周报生成

| ID        | 需求        | 说明                                                           |
| --------- | --------- | ------------------------------------------------------------ |
| **F‑A9**  | 周报 Prompt | 收集最近 7 天 done/updated 任务 → Prompt 输出 Markdown（完成、在途、风险、下周计划） |
| **F‑A10** | 导出渠道      | 一键复制 / 下载 `.md` / 推送到飞书文档 (Webhook)                          |

### 5.6 情绪 & 风险雷达

| ID        | 需求    | 说明                                          |
| --------- | ----- | ------------------------------------------- |
| **F‑A11** | 语义扫描  | Prompt：检测「延期、卡顿、外部依赖」情绪词，返回 risk\_level 1‑3 |
| **F‑A12** | UI 提示 | 右上角⚠️计数；点开浮窗列表 → 点击跳转卡片，并在卡片左上角显示红感叹号       |

---

## 6 · Non‑Functional Updates

* **NFR‑A1 性能**：全局搜索 ≤ 150 ms；/ai 操作平均响应 ≤ 3 s。
* **NFR‑A2 隐私**：向 LLM 仅发送最小必要内容；敏感数据可遮盖。

---

## 7 · Tech Notes

| 功能            | 关键技术                                               |
| ------------- | -------------------------------------------------- |
| Assistant Pen | OpenAI / Gemini chat completion (function‑calling) |
| Similarity    | `text-embedding-3-small` + FAISS local index       |
| Workload      | 简易规则 → 后续 fine‑tune based on user feedback         |
| Clustering    | HDBSCAN + island‑layout algorithm in front‑end     |
| Risk Radar    | Zero‑shot classification prompt；后续 RAG 业务词表        |

---

## 8 · Roadmap (Phase‑2)

| 周       | 主题                            | 主要交付                              |
| ------- | ----------------------------- | --------------------------------- |
| **W6**  | Assistant Pen & Global Search | `/ai` Mini‑Prompt、模糊搜索、卡片聚焦动画     |
| **W7**  | 子任务 & 关联检测                    | 子任务 JSON 生成 + FAISS 相似度弹窗         |
| **W8**  | 工时 & 冲突                       | 侧栏工时统计、红黄绿条；每日容量设置项               |
| **W9**  | 聚类岛视图                         | Embedding 计算 + 前端岛屿布局切换           |
| **W10** | 周报 & 风险雷达                     | Markdown 周报导出 + ⚠️ 列表；Beta 2.0 释放 |

---

## 9 · Risks & Mitigations (新增)

| 风险           | 影响          | 缓解                               |
| ------------ | ----------- | -------------------------------- |
| Embedding 费用 | 成本增加        | 缓存+批量调用；量大时切换 open‑source MiniLM |
| HDBSCAN 聚类误分 | 岛屿错乱        | 提供手动拖卡片调整后写回 island\_id          |
| 周报流水过长       | Markdown 冗余 | Prompt 限长 5000 tokens，超出按模块折叠    |

---

## 10 · Acceptance Criteria v2.0

1. `/ai` 命令在 90% 卡片上生成标题/描述满足可读性（人工评 ≥4/5）。
2. 全局搜索 1000 卡片时响应 ≤ 200 ms。
3. 自动子任务建议被用户接受率 ≥ 60%。
4. 日工时超载红条与用户感知一致性 ≥ 80%。
5. "主题岛"视图下，用户能在 10 秒内指出自己本周 3 大主题。
6. 一键周报输出后，复制进飞书排版无错位。

---

**End of PRD v2.0** 