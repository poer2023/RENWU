<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>功能测试验证</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .highlight {
            background: yellow;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>TaskWall 功能测试验证</h1>
    
    <div class="test-section">
        <h2>1. 缩放功能测试</h2>
        <div id="zoom-test"></div>
    </div>
    
    <div class="test-section">
        <h2>2. 空格键功能测试</h2>
        <div id="space-test"></div>
    </div>
    
    <div class="test-section">
        <h2>3. 源代码验证</h2>
        <div id="source-test"></div>
    </div>

    <script>
        // 测试缩放功能
        async function testZoomFeature() {
            const testDiv = document.getElementById('zoom-test');
            try {
                const response = await fetch('/assets/index-Bg1bLTRq.js');
                const jsContent = await response.text();
                
                // 查找缩放相关代码
                const zoomMatch = jsContent.match(/deltaY\s*\*\s*([\d.]+)/);
                if (zoomMatch) {
                    const zoomFactor = parseFloat(zoomMatch[1]);
                    if (Math.abs(zoomFactor - 0.003) < 0.0001) {
                        testDiv.innerHTML = `
                            <div class="status success">
                                ✅ 缩放功能已更新！
                                <br>当前缩放系数: <span class="highlight">${zoomFactor}</span>
                                <br>说明: 缩放幅度已从 0.01 降低到 0.003，减少了70%
                            </div>
                        `;
                    } else {
                        testDiv.innerHTML = `
                            <div class="status error">
                                ❌ 缩放功能未更新
                                <br>当前缩放系数: ${zoomFactor}
                                <br>期望值: 0.003
                            </div>
                        `;
                    }
                } else {
                    testDiv.innerHTML = '<div class="status error">❌ 未找到缩放相关代码</div>';
                }
            } catch (error) {
                testDiv.innerHTML = `<div class="status error">❌ 测试失败: ${error.message}</div>`;
            }
        }

        // 测试空格键功能
        async function testSpaceKeyFeature() {
            const testDiv = document.getElementById('space-test');
            try {
                const response = await fetch('/assets/index-Bg1bLTRq.js');
                const jsContent = await response.text();
                
                // 查找focusOnLatestTask函数
                const hasFunction = jsContent.includes('focusOnLatestTask');
                const hasSpaceKey = jsContent.includes('Space') || jsContent.includes(' ');
                
                if (hasFunction) {
                    testDiv.innerHTML = `
                        <div class="status success">
                            ✅ 空格键定位功能已添加！
                            <br>功能说明:
                            <ul>
                                <li>按空格键可快速定位到最新创建的任务</li>
                                <li>任务会居中显示并有蓝色高亮效果</li>
                                <li>也可通过命令面板(Ctrl+K)搜索"定位最新任务"</li>
                            </ul>
                        </div>
                    `;
                } else {
                    testDiv.innerHTML = '<div class="status error">❌ 未找到focusOnLatestTask函数</div>';
                }
            } catch (error) {
                testDiv.innerHTML = `<div class="status error">❌ 测试失败: ${error.message}</div>`;
            }
        }

        // 显示关键代码片段
        async function showSourceCode() {
            const testDiv = document.getElementById('source-test');
            try {
                const response = await fetch('/assets/index-Bg1bLTRq.js');
                const jsContent = await response.text();
                
                // 提取关键代码片段
                const zoomCode = jsContent.match(/.{0,100}deltaY\s*\*\s*[\d.]+.{0,100}/);
                const focusCode = jsContent.match(/.{0,50}focusOnLatestTask.{0,50}/);
                
                let html = '<div class="status info">关键代码片段：</div>';
                
                if (zoomCode) {
                    html += `
                        <h4>缩放代码:</h4>
                        <pre>${zoomCode[0].replace(/deltaY\s*\*\s*([\d.]+)/, '<span class="highlight">deltaY * $1</span>')}</pre>
                    `;
                }
                
                if (focusCode) {
                    html += `
                        <h4>定位功能代码:</h4>
                        <pre>${focusCode[0].replace(/focusOnLatestTask/, '<span class="highlight">focusOnLatestTask</span>')}</pre>
                    `;
                }
                
                testDiv.innerHTML = html;
            } catch (error) {
                testDiv.innerHTML = `<div class="status error">❌ 无法加载源代码: ${error.message}</div>`;
            }
        }

        // 运行所有测试
        async function runAllTests() {
            await testZoomFeature();
            await testSpaceKeyFeature();
            await showSourceCode();
        }

        // 页面加载完成后运行测试
        window.onload = runAllTests;
    </script>
</body>
</html> 